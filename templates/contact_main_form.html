{% load static %}
<div style="width: 1440px;
    height: 800px;
    margin: 36px auto 44px auto;
    background: rgba(255, 255, 255, 1);
    border-radius: 14px;
    box-shadow: 0 2px 8px rgba(60, 60, 60, 0.04);
    font-family: 'Montserrat', Arial, sans-serif;
    box-sizing: border-box;
    
    flex: 0 0 auto;
    align-self: flex-start;">
<div  class="callback-form-section" id="callback-form" >
  <p style="position: absolute;left: 135px;top: 94px;font-family: 'head2';font-size: 20px;font-weight: 400;color: rgba(0, 0, 0, 0.7);">Оставить заявку</p>
  <div class="callback-form-title">ЗАЯВКА НА ОБРАТНЫЙ ЗВОНОК</div>
  <div class="callback-form-subtitle">
    Подберем материалы максимально подходящие под ваш проект по стилю, форме и фактуре.<br>
    Наши специалисты найдут решение даже для самых смелых архитектурных решений
  </div>



  <form method="post" id="contact-form" action="{% url 'contact_request_create' %}">
    <div class="callback-form-row">
      <div class="callback-form-fields">
        <label style="font-size: 22px;font-family: 'head2';font-weight: 400;color: rgba(0, 0, 0, 1);">Сведения о заявителе</label>
        <div class="callback-form-fields-grid">
          <input type="text" class="call" placeholder="Имя" name="name" required>
          <input type="email" placeholder="Email" name="email">
          <input type="text" placeholder="Фамилия" name="surname">
          <input type="text" placeholder="Телефон" name="phone" required>
        </div>
      </div>
      <div class="callback-form-info">
        <label style="font-size: 22px;font-family: 'head2';font-weight: 400;color: rgba(0, 0, 0, 1);">Информация о проекте</label>
        <textarea placeholder="Краткое описание" name="about"></textarea>
      </div>
    </div>
    <div class="callback-form-bottom">
      <div class="callback-form-note">
        <svg fill="none" stroke="#aaa" stroke-width="2" viewBox="0 0 16 16"><circle cx="8" cy="8" r="7"/><line x1="8" y1="4" x2="8" y2="8"/><circle cx="8" cy="11" r="1" fill="#aaa"/></svg>
        Мы гарантируем полное соблюдение ваших <br>интеллектуальных прав на разработку<br> и конфиденциальности предоставленной информации.
      </div>
      <button type="submit" class="callback-form-btn">Оставить заявку</button>
    </div>
  </form>
    <!-- алерт для сообщений -->
<div id="form-alert"
     class="alert d-none"
     role="alert"
     aria-live="polite"
     style="max-width: 720px; margin-top:14px"></div>
</div>
  </div>
<script>
(function () {
  const form  = document.getElementById('contact-form');
  const btn   = form.querySelector('.callback-form-btn');
  const alertBox = document.getElementById('form-alert');

  function showAlert(type, html, autohideMs = 6000) {
    alertBox.className = 'alert alert-' + (type === 'success' ? 'success' : 'danger');
    alertBox.innerHTML = html;
    alertBox.classList.remove('d-none');
    alertBox.scrollIntoView({behavior:'smooth', block:'center'});

    if (autohideMs) {
      clearTimeout(alertBox._t);
      alertBox._t = setTimeout(() => alertBox.classList.add('d-none'), autohideMs);
    }
  }

  function fieldErrorsToHTML(errorsObj) {
    // errorsObj = {first_name:["Обязательное поле."], email:["Некорректный email."], …}
    const items = [];
    for (const [field, msgs] of Object.entries(errorsObj || {})) {
      msgs.forEach(m => items.push(`<li><strong>${field}</strong>: ${m}</li>`));
    }
    return items.length ? `<ul style="margin:0; padding-left:18px">${items.join('')}</ul>` : '';
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    btn.disabled = true;

    try {
      const res = await fetch(form.action, {
        method: 'POST',
        body: new FormData(form),
        credentials: 'same-origin',
        // если вернёте CSRF-проверку — раскомментируйте строку ниже:
        // headers: { 'X-CSRFToken': form.querySelector('[name=csrfmiddlewaretoken]').value },
      });

      const data = await res.json();

      if (res.ok && data.ok) {
        showAlert('success', 'Спасибо! Ваша заявка успешно отправлена.');
        form.reset();
      } else {
        const details = fieldErrorsToHTML(data.errors);
        showAlert('error', `Не удалось отправить форму. ${details || 'Проверьте поля и попробуйте ещё раз.'}`);
      }
    } catch (err) {
      showAlert('error', 'Ошибка соединения. Проверьте интернет и попробуйте ещё раз.');
    } finally {
      btn.disabled = false;
    }
  });
})();
</script>

<style>
    #callback-form input.has-error,
#callback-form textarea.has-error { border-color:#E64646 !important; }
    .call{
  position: relative;
}
.callback-form-fields-grid input::placeholder {
  position: absolute;
  left: 22px;
  top: 32px;
  font-family: 'head2';
  font-size: 20px;
  font-weight: 400;
  color: rgba(0, 0, 0, 0.4);
}
textarea::placeholder{
  position: absolute;
  left: 37px;
  top: 137px;
  font-family: 'head2';
  font-size: 20px;
  font-weight: 400;
  color: rgba(0, 0, 0, 0.4);
}
.callback-form-section {
  position: relative;
  max-width: 1440px;
  min-height: 800px;
  margin: 36px auto 44px auto;
  background: rgba(255, 255, 255, 1);
  border-radius: 14px;
  box-shadow: 0 2px 8px rgba(60,60,60,0.04);
  font-family: 'Montserrat', Arial, sans-serif;
  box-sizing: border-box;
  padding: 100px;
}

.callback-form-title {
  position: absolute;
  left: 139px;
  top:138px ;
  font-family: 'namu';
  font-size: 28px;
  font-weight: 300;
  color: rgba(0, 0, 0, 1);

  text-align: left;
  letter-spacing: 0;
  line-height: 100%;
}
.callback-form-subtitle {
  position: absolute;
  left: 136px;
  top: 211px;
  font-family: 'head2';
  color: rgba(129, 129, 129, 1);
  font-size: 20px;
  font-weight: 400;

  width: 480px;
  line-height: 100%;
}
.callback-form-row {
  display: flex;
  gap: 48px;
  position: absolute;
  left: 135px;
  top: 387px;
}
.callback-form-fields {
  flex: 2;
}
.callback-form-fields label {
  font-size: 1.07rem;
  margin-bottom: 8px;
  font-weight: 500;
  display: block;
  color: #191919;
}
.callback-form-fields-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 36px 66px;
  margin-bottom: 18px;
}
.callback-form-fields input {

  width: 300px;
  height: 74px;

  border: 1.5px solid #e4e4e4;
  border-radius: 8px;
  font-size: 1.05rem;
  background: #fff;
  font-family: 'Montserrat', Arial, sans-serif;
  transition: border .14s;
}
.callback-form-fields input:focus,
.callback-form-fields textarea:focus {
  outline: none;
  border: 1.5px solid #a4cc6a;
}
.callback-form-fields textarea {

  width: 455px;
  height: 188px;

  border: 1.5px solid #e4e4e4;
  border-radius: 8px;
  font-size: 1.05rem;
  background: #fff;
  font-family: 'Montserrat', Arial, sans-serif;
  resize: vertical;
  transition: border .14s;
}
.callback-form-info {
  flex: 1;
  height: 188px;
}
.callback-form-info label {
  font-size: 1.07rem;
  margin-bottom: 8px;
  font-weight: 500;
  color: #191919;
  display: block;
}
.callback-form-info textarea {

  height: 188px;
  width: 455px;
  border: 1.5px solid #e4e4e4;
  border-radius: 8px;
  font-size: 1.05rem;
  background: #fff;
  font-family: 'Montserrat', Arial, sans-serif;
  resize: vertical;
  margin-bottom: 0;
  transition: border .14s;
}
.callback-form-info textarea:focus {
  border: 1.5px solid #a4cc6a;
  outline: none;
}
.callback-form-bottom {
  display: flex;
  align-items: center;
  position: absolute;
  left: 136px;
  top: 672px;
  gap: 556px;
  flex-wrap: wrap;
  justify-content: space-between;
}
.callback-form-note {
  color: rgba(0, 0, 0, 0.7);
  font-size: 14px;
  font-weight: 400;
  font-family: "head2";
  margin-left: 2px;
  display: flex;
  line-height: 100%;
  align-items: flex-start;
  gap: 8px;
  max-width: 520px;
}
.callback-form-note svg {
  flex-shrink: 0;
  width: 18px;
  height: 18px;
  margin-top: 1.5px;
}
.callback-form-btn {
  padding: 13px 38px;
  background: #328400;
  color: #fff;
  border: none;
  border-radius: 8px;
  font-size: 1.11rem;
  font-family: 'Montserrat', Arial, sans-serif;
  font-weight: 500;
  cursor: pointer;
  margin-left: auto;
  box-shadow: 2px 4px 0 #9bc18a;
  transition: background .16s, box-shadow .16s;
}
.callback-form-btn:hover {
  background: #246a00;
  box-shadow: 1px 2px 0 #82a571;
}

/* ====== tablet & down ====== */
@media (max-width: 1310px){

  /* контейнер блока */
  #callback-form{
    padding: 24px 16px !important;
    min-height: auto;
    width: 100% !important;      /* чтобы внутренняя секция влезала */
    box-sizing: border-box;
  }

  /* отключаем абсолюты у элементов шапки/рядов */
  #callback-form .callback-form-title,
  #callback-form .callback-form-subtitle,
  #callback-form .callback-form-row,
  #callback-form .callback-form-bottom,
  #callback-form > p{
    position: static !important;
    left: auto !important;
    top: auto !important;
    margin: 0 0 14px 0;
  }

  /* сетки в колонку */
  .callback-form-row{
    display: grid !important;
    grid-template-columns: 1fr;
    gap: 20px;
    align-items: start;
  }
  .callback-form-fields-grid{
    display: grid !important;
    grid-template-columns: 1fr;
    gap: 14px;
    margin-bottom: 12px;
  }

  /* поля и текстовые области — на всю ширину и компактнее */
  .callback-form-fields input,
  .callback-form-fields textarea,
  .callback-form-info textarea{
    width: 100% !important;
    box-sizing: border-box;
    padding: 12px 16px;
    font-size: 16px;
  }
  .callback-form-fields input{ height: 52px; }
  .callback-form-fields textarea,
  .callback-form-info textarea{ min-height: 120px; height: auto; }

  /* сбрасываем твои абсолютные плейсхолдеры */
  .callback-form-fields-grid input::placeholder,
  #callback-form textarea::placeholder{
    position: static;
    left: auto; top: auto;
    font-size: 16px;
  }

  /* низ формы */
  .callback-form-bottom{
    display: flex !important;
    flex-direction: column;
    align-items: stretch;
    gap: 16px;
    margin-top: 8px;
  }
  .callback-form-btn{
    width: 100%;
    max-width: 360px;
    margin-left: 0;
    padding: 12px 24px;
    font-size: 16px;
  }

  /* немного уменьшаем типографику */
  .callback-form-title{ font-size: 26px !important; line-height: 1.15; }
  .callback-form-subtitle{ font-size: 16px !important; line-height: 1.35; width: auto !important; }
}

/* ====== phones ====== */
@media (max-width: 600px){
  #callback-form{ padding: 18px 12px !important; }
  .callback-form-title{ font-size: 22px !important; }
  .callback-form-subtitle{ font-size: 14px !important; }
  .callback-form-note{ font-size: 13px; line-height: 1.3; }
}

/* страховка от горизонтального скролла из-за внешнего inline-обёртки */
@media (max-width: 1200px){
  html, body{ overflow-x: clip; }
}


/* ===== phones: 420px и ниже — ужимаем типографику и включаем мягкие переносы ===== */
@media (max-width: 420px){
  #callback-form{
    padding: 18px 12px !important;
    box-sizing: border-box;
  }

  /* Заголовок: меньше кегль + безопасные переносы */
  #callback-form .callback-form-title{
    font-size: clamp(20px, 7vw, 24px) !important;
    line-height: 1.15;
    letter-spacing: 0 !important;
    word-break: normal !important;
    overflow-wrap: break-word;
    hyphens: auto;
    text-wrap: balance; /* если поддерживается — красивее балансирует строки */
  }

  /* Подзаголовок: компактнее и обязательно в ширину контейнера */
  #callback-form .callback-form-subtitle{
    width: 100% !important;
    max-width: none !important;
    font-size: 14px !important;
    line-height: 1.4;
    word-break: normal;
    overflow-wrap: anywhere; /* если слишком длинно — всё равно переносим */
    hyphens: auto;
  }

  /* Малый заголовок и подписи групп */
  #callback-form > p{ font-size: 16px !important; }
  #callback-form .group-title{ font-size: 18px !important; }

  /* Примечание внизу — чтобы не выпирало */
  .callback-form-note{
    font-size: 12.5px;
    line-height: 1.3;
    word-break: break-word;
    overflow-wrap: anywhere;
  }

  /* Чуть компактнее поля и кнопка */
  .callback-form-fields input{ height: 48px; }
  .callback-form-fields textarea,
  .callback-form-info textarea{ min-height: 110px; }
  .callback-form-btn{
    font-size: 15px;
    padding: 12px 18px;
  }

  /* Плейсхолдеры тоже уменьшим */
  .callback-form-fields-grid input::placeholder,
  #callback-form textarea::placeholder{ font-size: 15px; }
}




/* ===== Сбрасываем фиксированную ширину внешнего inline-контейнера на мобилке ===== */
@media (max-width: 768px){
  /* ловим тот самый div со style="width: 1440px; ..." */
  div[style*="width: 1440px"]{
    width: 100% !important;
    height: auto !important;
    margin: 16px auto !important;
    padding: 0 !important;
    box-sizing: border-box;
  }
}

/* ===== Мобильный текст: делаем влезаемым и с переносами ===== */
@media (max-width: 480px){
  /* сам белый блок */
  #callback-form{
    padding: 16px 12px !important;
    min-height: auto !important;
    box-sizing: border-box;
  }

  /* заголовок */
  #callback-form .callback-form-title{
    font-size: clamp(18px, 7.2vw, 22px) !important; /* уменьшаем кегль */
    line-height: 1.15 !important;
    letter-spacing: 0 !important;
    white-space: normal !important;
    word-break: normal !important;
    overflow-wrap: anywhere !important; /* мягкие переносы даже в длинных словах */
    hyphens: auto;                      /* переносы по слогам (lang="ru" желательно) */
  }

  /* подзаголовок */
  #callback-form .callback-form-subtitle{
    width: 100% !important;
    max-width: none !important;
    font-size: 14px !important;
    line-height: 1.4 !important;
    overflow-wrap: anywhere;
    hyphens: auto;
    margin-bottom: 12px !important;
  }

  /* мелкий заголовок и подписи */
  #callback-form > p{ font-size: 16px !important; margin: 0 0 8px !important; }
  .group-title{ font-size: 18px !important; }

  /* поля компактнее */
  .callback-form-fields-grid{ grid-template-columns: 1fr !important; gap: 12px !important; }
  .callback-form-fields input{ height: 48px !important; font-size: 15px !important; padding: 12px 14px !important; }
  .callback-form-fields textarea,
  .callback-form-info textarea{ min-height: 110px !important; font-size: 15px !important; padding: 12px 14px !important; }

  /* плейсхолдеры — без абсолютного позиционирования */
  .callback-form-fields-grid input::placeholder,
  #callback-form textarea::placeholder{
    position: static !important;
    left: auto !important; top: auto !important;
    font-size: 15px !important;
  }

  /* подвал формы */
  .callback-form-bottom{
    flex-direction: column !important;
    align-items: stretch !important;
    gap: 12px !important;
    margin-top: 8px !important;
  }
  .callback-form-note{ font-size: 12.5px !important; line-height: 1.3 !important; }
  .callback-form-btn{ width: 100% !important; max-width: 360px; font-size: 15px !important; padding: 12px 18px !important; }
}

</style>

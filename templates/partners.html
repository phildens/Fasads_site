{% load static %}

<div class="logos-section" id="manufactors">
    <div class="logos-inner">
        <div class="logos-section-title">
            <p>Мы являемся официальными дилерами 22 заводов-производителей</p>
        </div>

        <!-- один ряд, горизонтальный слайдер на всех размерах -->
        <div class="logos-row" id="logos-slider">
            <div class="logo-card"><img draggable="false" src="{% static 'imgfolder/logo1.png' %}" alt="Пятый элемент">
            </div>
            <div class="logo-card"><img draggable="false" src="{% static 'imgfolder/logo2.png' %}" alt="ARHIO"></div>
            <div class="logo-card"><img draggable="false" src="{% static 'imgfolder/logo3.png' %}"
                                        alt="Recke Brickerei"></div>
            <div class="logo-card"><img draggable="false" src="{% static 'imgfolder/logo4.png' %}"
                                        alt="Laterem Antique"></div>
            <div class="logo-card"><img draggable="false" src="{% static 'imgfolder/logo5.png' %}"
                                        alt="Skriaibin Ceramics"></div>
            <div class="logo-card"><img draggable="false" src="{% static 'imgfolder/logo6.png' %}" alt="ЛСР"></div>
            <div class="logo-card"><img draggable="false" src="{% static 'imgfolder/logo7.png' %}" alt="Царский Кирпич">
            </div>
            <div class="logo-card"><img draggable="false" src="{% static 'imgfolder/logo8.png' %}" alt="Ströher"></div>
            <div class="logo-card"><img draggable="false" src="{% static 'imgfolder/manufactors/2.png' %}"
                                        alt="Ströher"></div>
            <div class="logo-card"><img draggable="false" src="{% static 'imgfolder/manufactors/4.png' %}"
                                        alt="Ströher"></div>
            <div class="logo-card"><img draggable="false" src="{% static 'imgfolder/manufactors/8.png' %}"
                                        alt="Ströher"></div>
            <div class="logo-card"><img draggable="false" src="{% static 'imgfolder/manufactors/9.jpg' %}"
                                        alt="Ströher"></div>
            <div class="logo-card"><img draggable="false" src="{% static 'imgfolder/manufactors/10.png' %}"
                                        alt="Ströher"></div>
            <div class="logo-card"><img draggable="false" src="{% static 'imgfolder/manufactors/11.jpg' %}"
                                        alt="Ströher"></div>
            <div class="logo-card"><img draggable="false" src="{% static 'imgfolder/manufactors/14.png' %}"
                                        alt="Ströher"></div>
            <div class="logo-card"><img draggable="false" src="{% static 'imgfolder/manufactors/17.jpg' %}"
                                        alt="Ströher"></div>
            <div class="logo-card"><img draggable="false" src="{% static 'imgfolder/manufactors/18.png' %}"
                                        alt="Ströher"></div>
            <div class="logo-card"><img draggable="false" src="{% static 'imgfolder/manufactors/13.jpg' %}"
                                        alt="Ströher"></div>
        </div>
    </div>
</div>

<script>
    (function () {
        const slider = document.getElementById('logos-slider');
        if (!slider) return;

        // --- Drag / Swipe для всех размеров ---
        let isDown = false, startX = 0, startLeft = 0;

        const getX = (e) => (e.touches && e.touches[0]?.pageX) ?? e.pageX;

        const onPointerDown = (e) => {
            isDown = true;
            slider.classList.add('dragging');
            startX = getX(e);
            startLeft = slider.scrollLeft;
            pauseAutoplay();
        };
        const onPointerMove = (e) => {
            if (!isDown) return;
            const x = getX(e);
            slider.scrollLeft = startLeft + (startX - x);
        };
        const onPointerUp = () => {
            if (!isDown) return;
            isDown = false;
            slider.classList.remove('dragging');
            resumeAutoplaySoon();
        };

        slider.addEventListener('mousedown', onPointerDown);
        window.addEventListener('mousemove', onPointerMove);
        window.addEventListener('mouseup', onPointerUp);
        slider.addEventListener('touchstart', onPointerDown, {passive: true});
        slider.addEventListener('touchmove', onPointerMove, {passive: true});
        slider.addEventListener('touchend', onPointerUp);

        // Горизонтальный скролл колесом мыши

        // --- Автопрокрутка (для всех размеров) ---
        const reduceMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        let autoTimer = null, resumeTimer = null;

        function cardStep() {
            const card = slider.querySelector('.logo-card');
            if (!card) return 0;

            return card.offsetWidth + gap;
        }

        function tick() {
            const step = cardStep();
            if (!step) return;
            const maxScroll = slider.scrollWidth - slider.clientWidth;
            const next = (slider.scrollLeft + step >= maxScroll - 2) ? 0 : (slider.scrollLeft + step);
            slider.scrollTo({left: next, behavior: 'smooth'});
        }

        function startAutoplay() {
            if (reduceMotion || autoTimer) return;
            autoTimer = setInterval(tick, 2500);
        }

        function pauseAutoplay() {
            if (autoTimer) {
                clearInterval(autoTimer);
                autoTimer = null;
            }
            if (resumeTimer) {
                clearTimeout(resumeTimer);
                resumeTimer = null;
            }
        }

        function resumeAutoplaySoon() {
            if (reduceMotion) return;
            if (resumeTimer) clearTimeout(resumeTimer);
            resumeTimer = setTimeout(startAutoplay, 1800);
        }

        // защитимся от перетаскивания изображений
        slider.querySelectorAll('img').forEach(img => img.setAttribute('draggable', 'false'));

        // старт
        startAutoplay();

        // при ресайзах пересчитаем шаг
        window.addEventListener('resize', () => {
            pauseAutoplay();
            resumeAutoplaySoon();
        });
    })();
</script>

<style>
    /* Секция и контейнер */
    .logos-section {
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
        text-align: left;
    }

    .logos-inner {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 16px;
        box-sizing: border-box;
    }

    /* Заголовок */
    .logos-section-title {
        margin-bottom: 24px;
    }

    .logos-section-title p {
        margin: 0;
        font-family: Muller-medium;
        font-weight: 500;
        font-size: 24px;
        line-height: 100%;
        overflow-wrap: anywhere;
        word-break: break-word;
    }

    /* --- Слайдер в одну строку на всех размерах --- */
    .logos-row {
        display: flex;
        gap: 24px;
        overflow-x: auto;
        overflow-y: visible;
        -webkit-overflow-scrolling: touch;
        scroll-snap-type: x mandatory;
        scrollbar-width: none; /* Firefox */
        padding: 8px 4px 12px;
        overscroll-behavior-x: contain;
    }

    .logos-row::-webkit-scrollbar {
        display: none;
    }

    /* WebKit */

    /* Карточки */
    .logo-card {
        flex: 0 0 auto; /* не переносится, одна строка */
        width: clamp(220px, 23vw, 280px);
        height: clamp(160px, 22vw, 269px);
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 1px 6px rgba(51, 51, 51, .04);
        display: flex;
        align-items: center;
        justify-content: center;
        scroll-snap-align: center;
        transition: box-shadow .16s;
    }

    .logo-card img {
        max-width: 70%;
        max-height: 70%;
        width: auto;
        height: auto;
        object-fit: contain;
        -webkit-user-drag: none;
        user-select: none;
        pointer-events: none;
    }

    /* Курсор при перетаскивании */
    .logos-row.dragging {
        cursor: grabbing;
    }

    /* Узкие экраны — немного плотнее */
    @media (max-width: 600px) {
        .logos-inner {
            padding: 0 20px;
        }

        .logos-row {
            gap: 16px;
        }

        .logo-card {
            width: clamp(180px, 70vw, 260px);
            height: clamp(140px, 40vw, 240px);
        }
    }
</style>
